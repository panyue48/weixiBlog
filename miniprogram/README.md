# 微信小程序端 - 个人博客系统

基于 UniApp + Vue 3 开发的微信小程序端，复用现有 Spring Boot 后端 API。

## 📋 项目结构

```
miniprogram/
├── src/
│   ├── api/              # API接口封装
│   │   └── index.js
│   ├── pages/             # 页面文件
│   │   ├── index/         # 首页（博客列表）
│   │   ├── detail/        # 博客详情页
│   │   └── login/         # 登录页
│   ├── components/        # 公共组件
│   │   ├── blog-card/     # 博客卡片组件
│   │   ├── markdown-viewer/ # Markdown渲染组件
│   │   ├── empty-state/   # 空状态组件
│   │   └── loading/       # 加载组件
│   ├── utils/             # 工具函数
│   │   ├── request.js     # 网络请求封装
│   │   ├── auth.js        # 认证相关工具
│   │   ├── storage.js     # 本地存储封装
│   │   └── common.js      # 通用工具函数
│   ├── config/            # 配置文件
│   │   └── index.js       # 应用配置（API地址等）
│   ├── App.vue            # 应用入口
│   ├── main.js            # 主入口文件
│   ├── pages.json         # 页面配置
│   ├── manifest.json      # 应用配置
│   └── uni.scss           # uni-app样式变量
├── package.json
├── vite.config.js
└── README.md
```

## 🚀 快速开始

### 1. 安装依赖

```bash
cd miniprogram
npm install
```

**注意**：
- Node.js 版本 >= 16
- 使用最新的 npm 版本（建议使用 `npm install -g npm@latest` 更新）
- 如果安装过程中遇到版本冲突错误，可以尝试删除 `node_modules` 和 `package-lock.json` 后重新安装
- 如果编译时提示找不到 `@dcloudio/uni-components`，请确保已安装所有依赖（已包含在 package.json 中）

### 2. 配置后端API地址

编辑 `src/config/index.js`，配置不同环境的API地址：

```javascript
// 开发环境配置
development: {
  baseURL: 'http://localhost:8083/api'
},
// 生产环境配置
production: {
  baseURL: 'https://your-domain.com/api'  // 请替换为实际的生产环境地址
}
```

**环境切换说明：**
- 开发环境：将 `isDev` 设置为 `true`
- 生产环境：将 `isDev` 设置为 `false`（发布时）

这样可以在不同环境下自动使用对应的API地址，无需手动修改代码。

### 3. 运行项目

#### 方式一：使用 HBuilderX（推荐）

1. **打开 HBuilderX**
2. **导入项目**：
   - 文件 -> 导入 -> 从本地目录导入
   - 选择 `miniprogram` 目录
3. **运行到微信开发者工具**：
   - 运行 -> 运行到小程序模拟器 -> 微信开发者工具
   - 或者点击工具栏的运行按钮，选择"运行到小程序模拟器" -> "微信开发者工具"

**注意**：首次运行前需要：
- 确保已安装微信开发者工具
- 在 HBuilderX 中配置微信开发者工具路径（工具 -> 设置 -> 运行配置 -> 微信开发者工具路径）

#### 方式二：使用命令行

**H5 开发：**
```bash
npm run dev:h5
```

**微信小程序开发：**
```bash
npm run dev:mp-weixin
```

然后在微信开发者工具中打开 `dist/dev/mp-weixin` 目录。

### 4. 构建项目

#### H5 构建
```bash
npm run build:h5
```

#### 微信小程序构建
```bash
npm run build:mp-weixin
```

构建产物在 `dist/build/mp-weixin` 目录。

## 📱 功能说明

### 第一阶段功能（已完成）

- ✅ 项目初始化（UniApp + Vue 3）
- ✅ 网络请求封装（支持Session认证适配）
- ✅ 用户登录/退出功能
- ✅ 博客列表页（首页）
  - 搜索功能
  - 分类筛选
  - 标签筛选
  - 下拉刷新
  - 上拉加载更多
- ✅ 博客详情页（Markdown渲染）
- ✅ 基础UI组件开发
  - 博客卡片组件
  - Markdown渲染组件
  - 空状态组件
  - 加载组件

### 第二阶段功能（已完成）

- ✅ 分类页面
  - 网格布局展示所有分类
  - 显示每个分类下的博客数量
  - 点击分类跳转到首页并自动筛选
  - 下拉刷新
  - 空状态提示
  
- ✅ 标签页面
  - 标签云展示（彩色标签）
  - 不同大小和颜色的标签营造层次感
  - 点击标签跳转到首页并自动筛选
  - 下拉刷新
  - 空状态提示
  
- ✅ 归档页面
  - 按年份和月份分组展示所有博客
  - 按时间倒序排列（最新的在前）
  - 显示每月的博客数量
  - 点击博客跳转到详情页
  - 下拉刷新
  
- ✅ 首页筛选功能优化
  - 支持从分类页面跳转并自动筛选
  - 支持从标签页面跳转并自动筛选
  - 筛选状态保持
  - 移除登录限制，允许未登录用户浏览

### 第三阶段功能（已完成）

- ✅ 我的博客列表
  - 展示当前用户的所有博客（包含草稿）
  - 搜索功能
  - 筛选功能（按分类、发布状态）
  - 下拉刷新
  - 上拉加载更多
  - 删除博客功能
  - 发布/草稿状态切换
  - 点击博客进入编辑页
  
- ✅ 博客编辑/发布
  - 创建或编辑博客
  - 标题输入
  - Markdown 内容编辑
  - 分类选择
  - 标签选择（多选）
  - 首图设置（URL输入）
  - 发布状态选择（立即发布/保存草稿）
  - 表单验证
  - 图片预览
  
- ✅ 分类管理
  - 分类列表展示
  - 创建分类（名称、描述）
  - 编辑分类
  - 删除分类（需确认）
  - 空状态提示
  
- ✅ 标签管理
  - 标签列表展示（显示颜色）
  - 创建标签（名称、颜色选择）
  - 编辑标签
  - 删除标签（需确认）
  - 颜色预览
  - 空状态提示
  
- ✅ 个人信息管理
  - 显示用户信息（用户名、昵称、头像）
  - 修改昵称
  - 修改头像（URL输入）
  - 修改密码（旧密码、新密码、确认密码）
  - 表单验证
  - 头像预览

### 第四阶段功能（已完成）

- ✅ 性能优化
  - 请求防抖处理
  - 列表分页加载
  - 图片懒加载支持
  
- ✅ UI/UX优化
  - 统一的 Minimalism 设计风格
  - 流畅的动画过渡
  - 友好的错误提示
  - 完善的加载状态
  - 空状态提示
  
- ✅ 功能完善
  - 登录/注册功能
  - 登录状态管理
  - 页面间通信（事件总线）
  - 表单验证
  - 数据持久化

## 🔧 技术栈

- **框架**: UniApp (Vue 3 Composition API)
- **构建工具**: Vite
- **后端接口**: Spring Boot API（端口 8083）
- **认证方式**: Session 认证（通过手动管理Cookie适配）

## 📝 开发说明

### Session认证适配

由于小程序不支持Cookie，采用手动管理Cookie的方案：

1. 登录时从响应头获取 `Set-Cookie`
2. 将Cookie存储在本地存储
3. 每次请求手动在Header中携带Cookie

详见 `src/utils/request.js`。

### API接口

所有API接口封装在 `src/api/index.js` 中，包括：

- 用户相关：登录、退出、获取用户信息等
- 博客相关：列表、详情、创建、更新、删除等
- 分类相关：列表、创建、更新、删除等
- 标签相关：列表、创建、更新、删除等

### 页面路由

页面路由配置在 `src/pages.json` 中，当前包含：

**前台页面（无需登录）：**
- `/pages/index/index` - 首页（博客列表）
- `/pages/types/types` - 分类页面
- `/pages/tags/tags` - 标签页面
- `/pages/archive/archive` - 归档页面
- `/pages/detail/detail` - 博客详情页

**用户页面：**
- `/pages/login/login` - 登录/注册页

**管理页面（需登录）：**
- `/pages/my-blogs/my-blogs` - 我的博客列表
- `/pages/blog-edit/blog-edit` - 博客编辑/发布
- `/pages/type-manage/type-manage` - 分类管理
- `/pages/tag-manage/tag-manage` - 标签管理
- `/pages/profile/profile` - 个人信息管理

### TabBar 配置

底部导航栏包含4个Tab：
- 首页 - 博客列表
- 分类 - 分类浏览
- 标签 - 标签云
- 归档 - 时间线浏览

**注意**：登录/个人信息页面不在TabBar中，通过登录页的管理菜单进入。

## ⚠️ 注意事项

### HBuilderX 使用说明

1. **项目类型识别**：
   - 本项目使用 Vite 构建工具，HBuilderX 可能无法直接识别为 uni-app 项目
   - 如果 HBuilderX 无法自动识别，可以手动选择项目类型为 "uni-app"

2. **运行方式**：
   - **推荐**：使用命令行方式运行（`npm run dev:mp-weixin`），然后在微信开发者工具中打开生成的目录
   - 如果 HBuilderX 支持运行，按照上述"方式一"操作

3. **微信开发者工具配置**：
   - 在微信开发者工具中需要勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"
   - 位置：设置 -> 项目设置 -> 本地设置

### 其他注意事项

1. **开发环境配置**：确保后端服务运行在 `http://localhost:8083`，否则需要修改 `src/config/index.js` 中的 API 地址。

2. **生产环境配置**：需要在微信公众平台配置服务器域名（request合法域名）。

3. **Session认证**：小程序端通过手动管理Cookie来适配Session认证，如果后端改为Token认证会更简单。

4. **Markdown渲染**：当前使用简单的正则表达式处理Markdown，如需更完善的渲染，可以集成 `marked` 等库。

5. **首次运行**：
   - 确保已安装 Node.js 和 npm
   - 运行 `npm install` 安装依赖
   - 确保后端服务已启动

## 📚 参考文档

- [UniApp官方文档](https://uniapp.dcloud.net.cn/)
- [微信小程序开发文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [Vue 3官方文档](https://cn.vuejs.org/)

## ✅ 开发完成情况

### 已完成功能

- ✅ **第一阶段**：基础功能（项目初始化、网络请求、登录、博客列表、详情页）
- ✅ **第二阶段**：核心功能（分类页面、标签页面、归档页面、筛选优化）
- ✅ **第三阶段**：管理功能（我的博客、博客编辑、分类管理、标签管理、个人信息）
- ✅ **第四阶段**：优化与测试（性能优化、UI/UX优化、功能完善）

### 功能清单

**用户认证：**
- ✅ 用户登录
- ✅ 用户注册
- ✅ 用户退出
- ✅ 登录状态保持

**博客展示：**
- ✅ 博客列表（搜索、筛选、分页）
- ✅ 博客详情（Markdown渲染）
- ✅ 分类浏览
- ✅ 标签浏览
- ✅ 归档浏览

**博客管理（需登录）：**
- ✅ 我的博客列表
- ✅ 博客创建/编辑
- ✅ 博客删除
- ✅ 发布状态切换

**分类管理（需登录）：**
- ✅ 分类列表
- ✅ 分类创建
- ✅ 分类编辑
- ✅ 分类删除

**标签管理（需登录）：**
- ✅ 标签列表
- ✅ 标签创建
- ✅ 标签编辑
- ✅ 标签删除

**个人信息（需登录）：**
- ✅ 查看个人信息
- ✅ 修改昵称
- ✅ 修改头像
- ✅ 修改密码

## 🔄 后续优化建议
- 我的博客列表
- 博客编辑/发布
- 分类管理
- 标签管理
- 个人信息管理

### 第四阶段：优化与测试
- 性能优化
- UI/UX优化
- 兼容性测试
- 功能测试
- Bug修复

