# Redis 缓存验证指南

## ✅ 已完成的配置

1. ✅ 添加 Redis 依赖到 `pom.xml`
2. ✅ 配置 Redis 连接（端口 6380）到 `application.yml`
3. ✅ 创建 Redis 配置类 `RedisConfig.java`
4. ✅ 在 `BlogServiceImpl` 中添加缓存注解

---

## 🚀 验证步骤

### 步骤 1：确保 Redis 服务运行

在 CMD 窗口中，Redis 服务应该正在运行（黑框窗口保持打开）。

验证 Redis 是否运行：
```bash
redis-cli -p 6380 ping
```
应该返回：`PONG`

### 步骤 2：启动 Spring Boot 项目

启动项目后，查看控制台日志，应该看到：
- 没有 Redis 连接错误
- 项目正常启动

### 步骤 3：测试缓存功能

#### 测试 1：博客列表缓存

1. **第一次访问**（会查询数据库）
   - 打开浏览器访问：`http://localhost:3000`
   - 查看后端控制台，应该看到日志：
     ```
     查询博客列表 - 从数据库加载: current=1, size=10...
     ```

2. **第二次访问**（会从缓存读取）
   - 刷新页面或再次访问
   - 查看后端控制台，**不应该**看到 "从数据库加载" 的日志
   - 说明缓存生效了！

#### 测试 2：博客详情缓存

1. **第一次点击博客**（会查询数据库）
   - 点击任意一篇博客进入详情页
   - 查看后端控制台，应该看到：
     ```
     查询博客详情 - 从数据库加载: id=1
     ```

2. **第二次访问相同博客**（会从缓存读取）
   - 返回列表，再次点击同一篇博客
   - 查看后端控制台，**不应该**看到 "从数据库加载" 的日志

#### 测试 3：缓存清除

1. **在后台管理页面新增/修改/删除博客**
2. **再次访问前台博客列表**
3. **应该看到 "从数据库加载" 的日志**（说明缓存已清除，重新从数据库加载）

---

## 🔍 使用 Redis CLI 查看缓存

打开新的 CMD 窗口，输入：

```bash
redis-cli -p 6380
```

### 查看所有缓存键

```bash
127.0.0.1:6380> KEYS *
```

应该看到类似：
```
1) "blogList::1_10____1"
2) "blogDetail::1"
```

### 查看具体缓存内容

```bash
# 查看博客列表缓存
127.0.0.1:6380> GET "blogList::1_10____1"

# 查看博客详情缓存
127.0.0.1:6380> GET "blogDetail::1"
```

### 清除所有缓存（测试用）

```bash
127.0.0.1:6380> FLUSHALL
```

---

## 📊 缓存策略说明

### 已缓存的接口

1. **博客列表** (`getBlogPage`)
   - 缓存键格式：`blogList:页码_每页数量_关键词_分类ID_标签ID_发布状态`
   - 过期时间：1小时
   - 示例：`blogList:1_10____1`（第1页，每页10条，无关键词，无分类，无标签，已发布）

2. **博客详情** (`getBlogDetail`)
   - 缓存键格式：`blogDetail:博客ID`
   - 过期时间：1小时
   - 示例：`blogDetail:1`

### 缓存清除时机

以下操作会自动清除所有博客相关缓存：
- ✅ 新增博客 (`saveBlog`)
- ✅ 更新博客 (`updateBlog`)
- ✅ 删除博客 (`deleteBlog`)

---

## ⚠️ 常见问题

### 1. 连接 Redis 失败

**错误信息**：`Unable to connect to Redis at localhost:6380`

**解决方法**：
- 确认 Redis 服务正在运行（CMD 黑框窗口）
- 确认端口是 6380（不是 6379）
- 检查防火墙设置

### 2. 缓存不生效

**可能原因**：
- Redis 服务未启动
- 端口配置错误（应该是 6380）
- `@EnableCaching` 注解未生效

**检查方法**：
- 查看控制台是否有 Redis 连接错误
- 使用 `redis-cli -p 6380` 测试连接
- 查看日志中是否有缓存相关错误

### 3. 缓存未清除

**可能原因**：
- 事务未提交
- `@CacheEvict` 注解未生效

**检查方法**：
- 查看日志中是否有 "清除缓存" 的日志
- 使用 Redis CLI 查看缓存键是否还存在

---

## ✅ 验证清单

- [ ] Redis 服务运行在 6380 端口
- [ ] Spring Boot 项目正常启动（无 Redis 连接错误）
- [ ] 第一次访问博客列表，看到 "从数据库加载" 日志
- [ ] 第二次访问博客列表，**不**看到 "从数据库加载" 日志
- [ ] 使用 `redis-cli -p 6380 KEYS *` 能看到缓存键
- [ ] 新增/修改/删除博客后，缓存被清除

---

**完成以上验证后，Redis 缓存功能就正常工作了！** 🎉

