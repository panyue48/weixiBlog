# Redis 缓存验证指南

## 📊 从你的日志分析

从你提供的日志来看：
- ✅ 有 TypeMapper 和 TagMapper 的查询（这些没有缓存，正常）
- ✅ 有 BlogMapper.incrementViews 的更新（浏览量更新，没有缓存，正常）
- ❓ **没有看到 "查询博客列表 - 从数据库加载" 的日志**

**这说明两种情况之一：**
1. ✅ **缓存生效了** - 数据从缓存读取，没有执行方法体，所以没有日志
2. ❌ **还没有访问博客列表** - 需要访问首页才能触发博客列表查询

---

## 🔍 验证缓存是否生效（3步测试）

### 步骤 1：清除所有缓存（确保从零开始）

打开 CMD，执行：
```bash
redis-cli -p 6380
FLUSHALL
exit
```

### 步骤 2：第一次访问博客列表（应该看到日志）

1. **访问首页**：`http://localhost:3000`
2. **查看后端控制台日志**，应该看到：
   ```
   查询博客列表 - 从数据库加载: current=1, size=10, keyword=null, typeId=null, tagId=null, published=1
   ```
3. **同时应该看到 SQL 查询日志**：
   ```
   DEBUG c.w.b.m.BlogMapper.selectBlogPage - ==>  Preparing: SELECT ...
   ```

### 步骤 3：第二次访问博客列表（应该看不到日志）

1. **刷新页面**或**再次访问首页**
2. **查看后端控制台日志**：
   - ❌ **不应该**看到 "查询博客列表 - 从数据库加载" 的日志
   - ❌ **不应该**看到 BlogMapper.selectBlogPage 的 SQL 查询日志
   - ✅ 如果满足以上条件，说明**缓存生效了**！

---

## 🧪 使用 Redis CLI 验证

### 查看缓存键

```bash
redis-cli -p 6380

# 查看所有缓存键
127.0.0.1:6380> KEYS *

# 应该看到类似：
# 1) "blogList::1_10____1"
# 2) "blogDetail::1"
```

### 查看缓存内容

```bash
# 查看博客列表缓存
127.0.0.1:6380> GET "blogList::1_10____1"

# 查看博客详情缓存（如果有访问过详情页）
127.0.0.1:6380> GET "blogDetail::1"
```

### 查看缓存过期时间

```bash
# 查看缓存剩余时间（秒）
127.0.0.1:6380> TTL "blogList::1_10____1"

# 应该返回类似：3599（表示还有3599秒过期，即约1小时）
```

---

## ✅ 缓存生效的标志

### 标志 1：日志行为

**第一次访问：**
```
✅ 看到 "查询博客列表 - 从数据库加载" 日志
✅ 看到 BlogMapper.selectBlogPage 的 SQL 查询
```

**第二次访问（相同参数）：**
```
❌ 看不到 "查询博客列表 - 从数据库加载" 日志
❌ 看不到 BlogMapper.selectBlogPage 的 SQL 查询
```

### 标志 2：Redis 中有缓存键

```bash
redis-cli -p 6380 KEYS *
# 应该看到 blogList:: 和 blogDetail:: 开头的键
```

### 标志 3：响应速度

- 第一次访问：较慢（查询数据库）
- 第二次访问：明显更快（从缓存读取）

---

## 🐛 如果缓存没有生效

### 检查 1：Redis 连接

查看启动日志，确认没有 Redis 连接错误：
```
❌ 不应该看到：Unable to connect to Redis
❌ 不应该看到：Connection refused
```

### 检查 2：缓存配置

确认 `RedisConfig.java` 存在且 `@EnableCaching` 注解已添加

### 检查 3：缓存注解

确认 `BlogServiceImpl.java` 中的方法有 `@Cacheable` 注解

### 检查 4：日志级别

确认日志级别设置为 DEBUG 或 INFO，能看到日志输出

---

## 📝 完整测试流程

```bash
# 1. 清除缓存
redis-cli -p 6380 FLUSHALL

# 2. 访问首页（第一次）
# 浏览器：http://localhost:3000
# 查看日志：应该看到 "从数据库加载"

# 3. 查看 Redis 缓存
redis-cli -p 6380 KEYS *

# 4. 刷新首页（第二次）
# 浏览器：刷新页面
# 查看日志：不应该看到 "从数据库加载"

# 5. 验证缓存
redis-cli -p 6380 GET "blogList::1_10____1"
```

---

## 🎯 快速判断

**如果满足以下条件，说明缓存成功：**

1. ✅ 第一次访问有 "从数据库加载" 日志
2. ✅ 第二次访问（相同参数）没有 "从数据库加载" 日志
3. ✅ Redis 中有缓存键（`KEYS *` 能看到）
4. ✅ 第二次访问速度明显更快

**如果都不满足，说明缓存可能没有生效，需要检查配置。**

